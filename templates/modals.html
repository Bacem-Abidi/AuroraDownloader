{% block modals %}
<div id="modal-overlay" class="modal-overlay hidden"></div>

<div id="match-modal" class="modal hidden">
  <div class="modal-card">
    <div class="modal-header">
      <h3>Choose a match</h3>
      <p id="match-modal-desc" class="modal-subtitle"></p>
    </div>

    <div id="match-list" class="match-list"></div>

    <div class="modal-footer">
      <div  class="actions">
        <button id="skip-match" class="btn btn-secondary">
          Skip this track
        </button>
        <button id="research-songs" class="btn btn-secondary" style="display:none;">
          Search as Song
        </button>
        <button id="research-videos" class="btn btn-secondary" style="display:none;">
          Search as video
        </button>
      </div>
      <div id="manual-video-wrapper" class="manual-video hidden">
        <input
          id="manual-video-id"
          type="text"
          placeholder="Paste YouTube video ID or URL"
        />
        <button id="manual-submit" class="btn btn-primary">
          Use video
        </button>
      </div>
    </div>
  </div>
</div>


<div id="retry-modal" class="modal hidden">
  <div class="modal-card">
    <!-- Header -->
    <div class="modal-header">
      <div class="redo-title">
        <i class="fas fa-redo"></i>
        <span>Retry Failed Downloads</span>
      </div>
      <button class="modal-close" id="retry-modal-close" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Main Content -->
    <div class="modal-content retry-content">

      <div class="option">
       <div class="playlist-row">
          <label for="retry-count-input" style="width: 75%;">Retry by number</label>
          <div class="retry-count-wrapper">
            <input type="text" placeholder="e.g. 5" id="retry-count-input" class="form-control"></select>
            <button id="retry-count-btn" class="btn btn-secondary">Retry</button>
          </div>
       </div> 
      </div>

      <!-- Retry by Playlist -->
      <div class="option">
       <div class="playlist-row">
          <label for="retry-playlist-select">Retry by Playlist</label>
          <div class="retry-playlist-wrapper">
            <select id="retry-playlist-select" class="form-control"></select>
            <button id="retry-playlist-btn" class="btn btn-secondary">Retry</button>
          </div>
       </div> 
      </div>

    </div>

    <!-- Footer -->
    <div class="modal-footer retry-footer">
      <button class="btn btn-danger" id="retry-modal-cancel">
        Cancel
      </button>
      <button id="retry-all-btn" class="btn btn-primary btn-block">
          <i class="fas fa-redo"></i> Retry All
        </button>
    </div>
  </div>
</div>

<!-- FAILED DOWNLOAD LAYOUT -->
<div id="failed-modal" class="modal hidden failed-layout failed-only" role="dialog" aria-modal="true">

  <div class="modal-header">
    <div class="failed-title">
      <i class="fas fa-exclamation-triangle"></i>
      <span>Failed Download</span>
    </div>
    <button class="modal-close" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="failed-url mono" id="failed-url"></div>

  <div class="failed-grid">
    <div><span>Playlist</span><strong id="failed-playlist"></strong></div>
    <div><span>Index</span><strong id="failed-index"></strong></div>

    <div><span>Format</span><strong id="failed-format"></strong></div>
    <div><span>Quality</span><strong id="failed-quality"></strong></div>

    <div class="full">
      <span>Type</span><strong id="failed-type"></strong>
    </div>
  </div>

  <div class="failed-divider">Failure Details</div>

  <div class="failed-statuses mono" id="failed-statuses"></div>

  <div class="failed-actions">
    <button class="btn retry-btn">
      <i class="fas fa-redo"></i> Retry
    </button>
    <button class="btn copy-btn" id="copy-btn">
      <i class="fas fa-copy"></i> Copy URL
    </button>
  </div>

</div>


<div id="info-modal" class="modal hidden normal-only" role="dialog" aria-modal="true">
  <div class="modal-header">
    <h3>Track Information</h3>
    <button class="modal-close" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="info-media">
    <!-- <img id="info-artwork" class="info-artwork" alt="Artwork"> -->
    <div class="info-meta">

      <!-- <span class="info-duration" id="info-duration"></span> -->
    </div>
  </div>
      <div class="artwork-section">
      <div class="artwork-preview-container">
        <div class="artwork-preview">
          <img id="info-artwork" class="info-artwork" alt="Artwork">
          <div id="edit-artwork-placeholder" class="artwork-placeholder">
            <i class="fas fa-image"></i>
            <span>No artwork</span>
          </div>
        </div>
        <div class="artwork-actions">
          <div class="info-column">
            <span class="info-label">Title</span>
            <span class="info-value" id="info-title"></span>
          </div>

          <div class="info-column">
            <span class="info-label">Artist</span>
            <span class="info-value" id="info-artist"></span>
          </div>

           <div class="info-column">
            <span class="info-label">Duration</span>
      <span class="info-duration" id="info-duration"></span>
          </div>
        </div>
      </div>
    </div>


  <div class="modal-content">


    <div class="info-row">
      <span class="info-label">Album</span>
      <span class="info-value" id="info-album"></span>
    </div>

    <div class="info-row">
      <span class="info-label">Year</span>
      <span class="info-value" id="info-year"></span>
    </div>

    <div class="info-row">
      <span class="info-label">Format</span>
      <span class="info-value" id="info-format"></span>
    </div>

    <div class="info-row">
      <span class="info-label">Path</span>
      <span class="info-value mono" id="info-path"></span>
    </div>
    <div class="info-section info-lyrics hidden" id="info-lyrics-section">
      <div class="info-lyrics-header">
        <span>Lyrics</span>
        <span class="lyrics-badge" id="lyrics-badge">LRC</span>
      </div>

      <div class="info-lyrics-content" id="info-lyrics-content">
        <!-- lyrics injected here -->
      </div>
    </div>
  </div>
</div>

<!-- Edit Metadata Modal -->
<div id="edit-modal" class="modal hidden normal-only">
  <div class="modal-header">
    <h3>Edit Metadata</h3>
    <button class="modal-close" id="edit-modal-close" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="modal-content">
    <!-- Artwork preview section -->
    <div class="artwork-section">
      <div class="artwork-preview-container">
        <div class="artwork-preview">
          <img id="edit-artwork-preview" class="info-artwork" alt="Artwork" style="display: none;">
          <div id="edit-artwork-placeholder" class="artwork-placeholder">
            <i class="fas fa-image"></i>
            <span>No artwork</span>
          </div>
        </div>
        <div class="artwork-actions">
          <button type="button" id="edit-artwork-upload" class="btn btn-secondary btn-small">
            <i class="fas fa-upload"></i> Upload
          </button>
          <button type="button" id="edit-artwork-url" class="btn btn-secondary btn-small">
            <i class="fas fa-link"></i> URL
          </button>
          <button type="button" id="edit-artwork-remove" class="btn btn-danger btn-small">
            <i class="fas fa-trash"></i> Remove
          </button>
        </div>
      </div>
      
      <!-- Hidden file input for upload -->
      <input type="file" id="edit-artwork-file" accept="image/*" style="display: none;">
      
      <!-- URL input container (initially hidden) -->
      <div id="edit-artwork-url-container" class="artwork-url-container" style="display: none;">
        <input type="text" id="edit-artwork-url-input" class="form-control" 
               placeholder="https://example.com/image.jpg">
        <div class="artwork-url-actions">
          <button type="button" id="edit-artwork-url-cancel" class="btn btn-secondary btn-small">
            Cancel
          </button>
          <button type="button" id="edit-artwork-url-load" class="btn btn-primary btn-small">
            Load
          </button>
        </div>
      </div>
    </div>

    <!-- Metadata form with inline label-input pairs -->
    <div class="metadata-form">
      <div class="info-row">
        <span class="info-label">Title *</span>
        <input type="text" id="edit-title" class="form-control edit-input" required>
      </div>

      <div class="info-row">
        <span class="info-label">Artist</span>
        <input type="text" id="edit-artist" class="form-control edit-input">
      </div>

      <div class="info-row">
        <span class="info-label">Album</span>
        <input type="text" id="edit-album" class="form-control edit-input">
      </div>

      <div class="info-row">
        <span class="info-label">Year</span>
        <input type="text" id="edit-year" class="form-control edit-input" maxlength="4" placeholder="YYYY">
      </div>

      <!-- File path display (read-only) -->
      <div class="info-row">
        <span class="info-label">File</span>
        <span class="info-value mono" id="edit-filename">-</span>
      </div>
    </div>
  </div>

  <!-- Footer buttons -->
  <div class="modal-footer row">
    <button class="btn btn-secondary" id="edit-modal-cancel">Cancel</button>
    <button class="btn btn-primary" id="edit-modal-save">Save Changes</button>
  </div>
</div>


<!-- Fix Playlist Modal -->
<div id="fix-playlist-modal" class="modal hidden">
  <div class="modal-card">
    <div class="modal-header">
      <h3>Fix Playlist</h3>
      <button class="modal-close" id="fix-playlist-modal-close" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-content">
      <div class="form-group">
        <label for="fix-playlist-url">Playlist URL</label>
        <input type="text" 
               id="fix-playlist-url" 
               class="form-control" 
               placeholder="https://www.youtube.com/playlist?list=..." />
        <small class="info-small-text text-muted">
          Enter the YouTube playlist URL to fix. The system will compare online tracks with local files using video IDs.
        </small>
      </div>

      <div class="options-grid" style="margin-top: 10px;">
        <label>Options</label>
        <div class="option-row">
          <label for="fix-download-missing">Download missing songs</label>
          <input type="checkbox" id="fix-download-missing" class="form-check-input" checked>
        </div>
        <div class="option-row">
          <label for="fix-create-log">Create detailed log file</label>
          <input type="checkbox" id="fix-create-log" class="form-check-input" checked>
        </div>
      </div>

      <div class="alert alert-info" style="margin-top: 10px;">
        <i class="fas fa-info-circle"></i>
        <strong>How it works:</strong><br>
        1. Compares online playlist with local files using video IDs<br>
        2. Downloads missing tracks<br>
        3. Updates playlist order<br>
        4. Shows summary of changes
      </div>
    </div>

    <div class="modal-footer row">
      <button id="fix-playlist-cancel" class="btn btn-secondary">Cancel</button>
      <button id="fix-playlist-submit" class="btn btn-primary">
        <i class="fas fa-wrench"></i> Fix Playlist
      </button>
    </div>
  </div>
</div>
{% endblock %}
